import{S as it,i as at,s as lt,F as ut,W as g}from"../../../chunks/vendor-64f33e0e.js";const $=1,tt=5,dt=2;class ht{constructor(u,o,l,t,s){this.items=u,this.radiusFun=o,this.xFun=l,this.padding=t,this.yOffset=s,this.tieBreakFn=this._sfc32(2654435769,608135816,3084996962,$),this.maxR=Math.max(...u.map(r=>o(r))),this.rng=this._sfc32(1,2,3,$)}calculateYPositions(){let u=this.items.map((t,s)=>({datum:t,originalIndex:s,x:this.xFun(t),r:this.radiusFun(t)+this.padding,y:null,placed:!1})).sort((t,s)=>t.x-s.x);u.forEach(function(t,s){t.index=s});let o=this.tieBreakFn;u.forEach(function(t){t.tieBreaker=o(t.x)});let l=[...u].sort((t,s)=>{let r=this.radiusFun(t.datum)+t.tieBreaker*tt,c=this.radiusFun(s.datum)+s.tieBreaker*tt;return r!=c?c-r:t.x-s.x});for(let t of l)t.placed=!0,t.y=this._getBestYPosition(t,u);return u.sort((t,s)=>t.originalIndex-s.originalIndex),u.map(t=>({x:t.x,y:t.y+this.yOffset,r:this.radiusFun(t.datum)}))}_sfc32(u,o,l,t){let s=function(){u>>>=0,o>>>=0,l>>>=0,t>>>=0;var r=u+o|0;return u=o^o>>>9,o=l+(l<<3)|0,l=l<<21|l>>>11,t=t+1|0,r=r+t|0,l=l+r|0,(r>>>0)/4294967296};for(let r=0;r<10;r++)s();return s}_getBestYPosition(u,o){let l=[];for(let s of[-1,1]){let r,c=u.r;for(let f=u.index+s;f>=0&&f<o.length&&(r=Math.abs(u.x-o[f].x))<c+this.maxR;f+=s){let y=o[f];if(!y.placed)continue;let w=c+y.r;if(r>=c+y.r)continue;let F=Math.sqrt(w*w-r*r),B=[y.y-F,y.y+F];l.push(B)}}if(l.length==0)return u.r*(this.rng()-.5)*dt;let t=l.flat();t.push(0),t.sort((s,r)=>{let c=Math.abs(s),f=Math.abs(r);return c<f?-1:c>f?1:s-r});for(let s=0;s<t.length;s++){let r=t[s];if(l.every(c=>r<=c[0]||r>=c[1]))return r}}}function pt(h,u,o){let l,t,s,r,c,f,y,w,F,B,G,P,C,M,I;const{data:q,x:A,y:W,r:L,xGet:V,yGet:z,rGet:H,xScale:J,yScale:K,yRange:N,rRange:Q,xDomain:T,yDomain:U,custom:X,width:Z}=ut("LayerCake");g(h,q,e=>o(20,I=e)),g(h,A,e=>o(18,C=e)),g(h,W,e=>o(17,P=e)),g(h,L,e=>o(16,G=e)),g(h,V,e=>o(25,r=e)),g(h,z,e=>o(29,w=e)),g(h,H,e=>o(27,f=e)),g(h,J,e=>o(23,t=e)),g(h,K,e=>o(22,l=e)),g(h,N,e=>o(24,s=e)),g(h,Q,e=>o(26,c=e)),g(h,T,e=>o(30,F=e)),g(h,U,e=>o(28,y=e)),g(h,X,e=>o(19,M=e)),g(h,Z,e=>o(15,B=e));let et=M.coords,R=M.type,v=B;function rt(e,D,x,m,nt,j){let a=D.mode,ot=D.padding,st=D.animation&&j==v?D.duration:0;v=j;let _;if(R=="bar"){let p=[],i=[];_=e.map((E,k)=>E.map((n,d)=>{p[d]||(p[d]=0),i[d]||(i[d]=0);let b=a=="default"||a=="grouped"||a=="comparison"&&k==0?F[0]:a=="stacked"&&x(n)>=0?p[d]:a=="stacked"?i[d]:x(n),Y=a=="default"||a=="grouped"||a=="comparison"&&k==0?x(n):a=="stacked"&&x(n)>=0?p[d]+x(n):a=="stacked"?i[d]+x(n):x(n);x(n)>=0?p[d]+=x(n):i[d]+=x(n);let S=a=="grouped"?w(n)+k*(l.bandwidth()/e.length):w(n),O=a=="grouped"?S+l.bandwidth()/e.length:S+l.bandwidth();return{x0:b,x1:Y,y0:S,y1:O}}))}else if(R=="column"){let p=[],i=[];_=e.map((E,k)=>E.map((n,d)=>{p[d]||(p[d]=0),i[d]||(i[d]=0);let b=a=="grouped"&&t.bandwidth?r(n)+k*(1/e.length)*t.bandwidth():a=="grouped"?r(n)[0]+k*(1/e.length)*Math.max(0,r(n)[1]-r(n)[0]):t.bandwidth?r(n):r(n)[0],Y=a=="grouped"&&t.bandwidth?b+t.bandwidth()/e.length:a=="grouped"?b+Math.max(0,r(n)[1]-r(n)[0])/e.length:t.bandwidth?b+t.bandwidth():b+Math.max(0,r(n)[1]-r(n)[0]),S=a=="default"||a=="grouped"||a=="comparison"&&k==0?y[0]:a=="stacked"&&m(n)>=0?p[d]:a=="stacked"?i[d]:m(n),O=a=="default"||a=="grouped"||a=="comparison"&&k==0?m(n):a=="stacked"&&m(n)>=0?p[d]+m(n):a=="stacked"?i[d]+m(n):m(n);return m(n)>=0?p[d]+=m(n):i[d]+=m(n),{x0:b,x1:Y,y0:S,y1:O}}))}else if(R=="scatter"){let p=i=>nt?f(i):c[0];_=m?e.map(i=>({x:x(i),y:m(i),r:p(i)})):new ht(e,i=>p(i),i=>r(i),ot,s[0]/2).calculateYPositions().map(i=>({x:t.invert(i.x),y:l.invert(i.y),r:i.r}))}else _=e.map(p=>p.map(i=>({x:x(i),y:m(i)})));R=="dotplot"&&console.log(_),et.set(_,{duration:st})}return h.$$.update=()=>{h.$$.dirty[0]&2064384&&rt(I,M,C,P,G,B)},[q,A,W,L,V,z,H,J,K,N,Q,T,U,X,Z,B,G,P,C,M,I]}class gt extends it{constructor(u){super();at(this,u,pt,null,lt,{},null,[-1,-1])}}export{gt as default};
